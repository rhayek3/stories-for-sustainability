{"version":3,"sources":["../src/createFirebaseInstance.js"],"names":["firebaseInstance","createFirebaseInstance","firebase","configs","dispatch","enableLogging","database","_","watchers","listeners","callbacks","queries","config","authUid","withMeta","method","path","value","onComplete","prefix","dataWithMeta","ServerValue","TIMESTAMP","auth","currentUser","uid","ref","actionCreators","signInWithPhoneNumber","authActions","initializeAuth","init","Object","assign","_reactReduxFirebaseExtended","set","setWithMeta","uniqueSet","transaction","d","then","committed","snapshot","newError","Error","Promise","reject","push","pushWithMeta","remove","options","queryActions","update","updateWithMeta","login","credentials","handleRedirectResult","authData","logout","updateAuth","authUpdate","updateInProfile","updateEmail","newEmail","updateProfile","profileUpdate","uploadFile","file","dbPath","storageActions","uploadFiles","files","deleteFile","createUser","profile","resetPassword","confirmPasswordReset","code","password","verifyPasswordResetCode","watchEvent","type","storeAs","unWatchEvent","queryId","reloadAuth","linkWithCredential","credential","promiseEvents","watchArray","inputAsFunc","prevData","queryConfigs","all","map","queryConfig","getFirebase"],"mappings":"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","sourcesContent":["import { isObject } from 'lodash'\nimport { merge } from 'lodash/fp'\nimport { getEventsFromInput, createCallable } from './utils'\nimport { mapWithFirebaseAndDispatch } from './utils/actions'\nimport { authActions, queryActions, storageActions } from './actions'\n\nlet firebaseInstance\n\n/**\n * Create an extended firebase instance that has methods attached\n * which dispatch redux actions.\n * @param {Object} firebase - Firebase instance which to extend\n * @param {Object} configs - Configuration object\n * @param {Function} dispatch - Action dispatch function\n * @return {Object} Extended Firebase instance\n */\nexport default function createFirebaseInstance(firebase, configs, dispatch) {\n  /* istanbul ignore next: Logging is external */\n  // Enable Logging based on config (handling instances without i.e RNFirebase)\n  if (\n    configs.enableLogging &&\n    firebase.database &&\n    typeof firebase.database.enableLogging === 'function'\n  ) {\n    firebase.database.enableLogging(configs.enableLogging)\n  }\n\n  // Add internal variables to firebase instance\n  const defaultInternals = {\n    watchers: {},\n    listeners: {},\n    callbacks: {},\n    queries: {},\n    config: configs,\n    authUid: null\n  }\n\n  firebase._ = merge(defaultInternals, firebase._) // eslint-disable-line no-param-reassign\n\n  /**\n   * @private\n   * Calls a method and attaches meta to value object\n   * @param {String} method - Method to run with meta attached\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Object|String|Boolean|Number} value - Value to write to Firebase\n   * @param {Function} onComplete - Function to run on complete\n   * @return {Promise} Containing reference snapshot\n   */\n  const withMeta = (method, path, value, onComplete) => {\n    if (isObject(value)) {\n      const prefix = method === 'update' ? 'updated' : 'created'\n      const dataWithMeta = {\n        ...value,\n        [`${prefix}At`]: firebase.database.ServerValue.TIMESTAMP\n      }\n      if (firebase.auth().currentUser) {\n        dataWithMeta[`${prefix}By`] = firebase.auth().currentUser.uid\n      }\n      return firebase\n        .database()\n        .ref(path)\n        [method](dataWithMeta, onComplete)\n    }\n    return firebase\n      .database()\n      .ref(path)\n      [method](value, onComplete)\n  }\n\n  /**\n   * Sets data to Firebase. More info available in\n   * [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#set).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Object|String|Boolean|Number} value - Value to write to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   * @example <caption>Basic</caption>\n   * import React, { Component } from 'react'\n   * import PropTypes from 'prop-types'\n   * import { firebaseConnect } from 'react-redux-firebase'\n   * function Example({ firebase: { set } }) {\n   *   return (\n   *     <button onClick={() => set('some/path', { here: 'is a value' })}>\n   *     Set To Firebase\n   *     </button>\n   *   )\n   * }\n   * export default firebaseConnect()(Example)\n   */\n  const set = (path, value, onComplete) =>\n    firebase\n      .database()\n      .ref(path)\n      .set(value, onComplete)\n\n  /**\n   * Sets data to Firebase along with meta data. Currently,\n   * this includes createdAt and createdBy. *Warning* using this function\n   * may have unintented consequences (setting createdAt even if data already\n   * exists). More info available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#update).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Object|String|Boolean|Number} value - Value to write to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   */\n  const setWithMeta = (path, value, onComplete) =>\n    withMeta('set', path, value, onComplete)\n\n  /**\n   * Pushes data to Firebase. More info\n   * available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#push).\n   * @param {String} path - Path to location on Firebase which to push\n   * @param {Object|String|Boolean|Number} value - Value to push to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   * @example <caption>Basic</caption>\n   * import React from 'react'\n   * import PropTypes from 'prop-types'\n   * import { firebaseConnect } from 'react-redux-firebase'\n   *\n   * function Example({ firebase: { push } }) {\n   *   return (\n   *     <button onClick={() => push('some/path', true)}>\n   *       Push To Firebase\n   *     </button>\n   *   )\n   * }\n   * export default firebaseConnect()(Example)\n   */\n  const push = (path, value, onComplete) =>\n    firebase\n      .database()\n      .ref(path)\n      .push(value, onComplete)\n\n  /**\n   * Pushes data to Firebase along with meta data. Currently,\n   * this includes createdAt and createdBy. More info\n   * available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#pushWithMeta).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Object|String|Boolean|Number} value - Value to write to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   */\n  const pushWithMeta = (path, value, onComplete) =>\n    withMeta('push', path, value, onComplete)\n\n  /**\n   * Updates data on Firebase and sends new data. More info\n   * available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#update).\n   * @param {String} path - Path to location on Firebase which to update\n   * @param {Object|String|Boolean|Number} value - Value to update to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   * @example <caption>Basic</caption>\n   * import React from 'react'\n   * import PropTypes from 'prop-types'\n   * import { firebaseConnect } from 'react-redux-firebase'\n   *\n   * function Example({ firebase: { update } }) {\n   *   function updateData() {\n   *     update('some/path', { here: 'is a value' })\n   *   }\n   * }\n   *   return (\n   *     <button onClick={updateData}>\n   *       Update To Firebase\n   *     </button>\n   *   )\n   * }\n   * export default firebaseConnect()(Example)\n   */\n  const update = (path, value, onComplete) =>\n    firebase\n      .database()\n      .ref(path)\n      .update(value, onComplete)\n\n  /**\n   * Updates data on Firebase along with meta. *Warning*\n   * using this function may have unintented consequences (setting\n   * createdAt even if data already exists). More info available\n   * in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#updateWithMeta).\n   * @param {String} path - Path to location on Firebase which to update\n   * @param {Object|String|Boolean|Number} value - Value to update to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   */\n  const updateWithMeta = (path, value, onComplete) =>\n    withMeta('update', path, value, onComplete)\n\n  /**\n   * Removes data from Firebase at a given path. **NOTE** A\n   * seperate action is not dispatched unless `dispatchRemoveAction: true` is\n   * provided to config on store creation. That means that a listener must\n   * be attached in order for state to be updated when calling remove.\n   * More info available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#remove).\n   * @param {String} path - Path to location on Firebase which to remove\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   * @example <caption>Basic</caption>\n   * import React from 'react'\n   * import PropTypes from 'prop-types'\n   * import { firebaseConnect } from 'react-redux-firebase'\n   *\n   * function Example({ firebase: { remove } }) {\n   *   return (\n   *     <button onClick={() => remove('some/path')}>\n   *       Remove From Firebase\n   *     </button>\n   *   )\n   * }\n   * export default firebaseConnect()(Example)\n   */\n  const remove = (path, onComplete, options) =>\n    queryActions.remove(firebase, dispatch, path, options).then(() => {\n      if (typeof onComplete === 'function') onComplete()\n      return path\n    })\n\n  /**\n   * Sets data to Firebase only if the path does not already\n   * exist, otherwise it rejects. Internally uses a Firebase transaction to\n   * prevent a race condition between seperate clients calling uniqueSet.\n   * More info available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#uniqueSet).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Object|String|Boolean|Number} value - Value to write to Firebase\n   * @param {Function} onComplete - Function to run on complete (`not required`)\n   * @return {Promise} Containing reference snapshot\n   * @example <caption>Basic</caption>\n   * import React, { Component } from 'react'\n   * import PropTypes from 'prop-types'\n   * import { firebaseConnect } from 'react-redux-firebase'\n   *\n   * function Example({ firebase: { uniqueSet } }) {\n   *   return (\n   *     <button onClick={() => uniqueSet('some/unique/path', true)}>\n   *       Unique Set To Firebase\n   *     </button>\n   *   )\n   * }\n   * export default firebaseConnect()(Example)\n   */\n  const uniqueSet = (path, value, onComplete) =>\n    firebase\n      .database()\n      .ref(path)\n      .transaction(d => (d === null ? value : undefined))\n      .then(({ committed, snapshot }) => {\n        if (!committed) {\n          const newError = new Error('Path already exists.')\n          if (onComplete) onComplete(newError)\n          return Promise.reject(newError)\n        }\n        if (onComplete) onComplete(snapshot)\n        return snapshot\n      })\n\n  /**\n   * Upload a file to Firebase Storage with the option to store\n   * its metadata in Firebase Database. More info available\n   * in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#uploadFile).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {File} file - File object to upload (usually first element from\n   * array output of select-file or a drag/drop `onDrop`)\n   * @param {String} dbPath - Database path to place uploaded file metadata\n   * @param {Object} options - Options\n   * @param {String} options.name - Name of the file\n   * @return {Promise} Containing the File object\n   */\n  const uploadFile = (path, file, dbPath, options) =>\n    storageActions.uploadFile(dispatch, firebase, {\n      path,\n      file,\n      dbPath,\n      options\n    })\n\n  /**\n   * Upload multiple files to Firebase Storage with the option\n   * to store their metadata in Firebase Database. More info available\n   * in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#uploadFiles).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {Array} files - Array of File objects to upload (usually from\n   * a select-file or a drag/drop `onDrop`)\n   * @param {String} dbPath - Database path to place uploaded files metadata.\n   * @param {Object} options - Options\n   * @param {String} options.name - Name of the file\n   * @return {Promise} Containing an array of File objects\n   */\n  const uploadFiles = (path, files, dbPath, options) =>\n    storageActions.uploadFiles(dispatch, firebase, {\n      path,\n      files,\n      dbPath,\n      options\n    })\n\n  /**\n   * Delete a file from Firebase Storage with the option to\n   * remove its metadata in Firebase Database. More info available\n   * in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#deleteFile).\n   * @param {String} path - Path to location on Firebase which to set\n   * @param {String} dbPath - Database path to place uploaded file metadata\n   * @return {Promise} Containing the File object\n   */\n  const deleteFile = (path, dbPath) =>\n    storageActions.deleteFile(dispatch, firebase, { path, dbPath })\n\n  /**\n   * Watch event. **Note:** this method is used internally\n   * so examples have not yet been created, and it may not work as expected.\n   * More info available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#watchEvent).\n   * @param {String} type - Type of watch event\n   * @param {String} path - Path to location on Firebase which to set listener\n   * @param {String} storeAs - Name of listener results within redux store\n   * @param {Object} options - Event options object\n   * @param {Array} options.queryParams - List of parameters for the query\n   * @param {String} options.queryId - id of the query\n   * @return {Promise}\n   */\n  const watchEvent = (type, path, storeAs, options = {}) =>\n    queryActions.watchEvent(firebase, dispatch, {\n      type,\n      path,\n      storeAs,\n      ...options\n    })\n\n  /**\n   * Unset a listener watch event. **Note:** this method is used\n   * internally so examples have not yet been created, and it may not work\n   * as expected. More info available in [the docs](http://docs.react-redux-firebase.com/history/v3.0.0/docs/api/props-firebase.html#unwatchevent).\n   * @param {String} type - Type of watch event\n   * @param {String} path - Path to location on Firebase which to unset listener\n   * @param {String} queryId - Id of the listener\n   * @param {Object} options - Event options object\n   * @return {Promise}\n   */\n  const unWatchEvent = (type, path, queryId, options = {}) =>\n    queryActions.unWatchEvent(firebase, dispatch, {\n      type,\n      path,\n      queryId,\n      ...options\n    })\n\n  /**\n   * Similar to the firebaseConnect Higher Order Component but\n   * presented as a function (not a React Component). Useful for populating\n   * your redux state without React, e.g., for server side rendering. Only\n   * `once` type should be used as other query types such as `value` do not\n   * return a Promise.\n   * @param {Array} watchArray - Array of objects or strings for paths to sync\n   * from Firebase. Can also be a function that returns the array. The function\n   * is passed the props object specified as the next parameter.\n   * @param {Object} options - The options object that you would like to pass to\n   * your watchArray generating function.\n   * @return {Promise}\n   */\n  const promiseEvents = (watchArray, options) => {\n    const inputAsFunc = createCallable(watchArray)\n    const prevData = inputAsFunc(options, firebase)\n    const queryConfigs = getEventsFromInput(prevData)\n    // TODO: Handle calling with non promise queries (must be once or first_child)\n    return Promise.all(\n      queryConfigs.map(queryConfig =>\n        queryActions.watchEvent(firebase, dispatch, queryConfig)\n      )\n    )\n  }\n\n  /**\n   * Logs user into Firebase. For examples, visit the\n   * [auth section of the docs](/docs/auth.md)\n   * @param {Object} credentials - Credentials for authenticating\n   * @param {String} credentials.provider - External provider (google |\n   * facebook | twitter)\n   * @param {String} credentials.type - Type of external authentication\n   * (popup | redirect) (only used with provider)\n   * @param {String} credentials.email - Credentials for authenticating\n   * @param {String} credentials.password - Credentials for authenticating (only used with email)\n   * @return {Promise} Containing user's auth data\n   */\n  const login = credentials =>\n    authActions.login(dispatch, firebase, credentials)\n\n  /**\n   * Logs user into Firebase using external. For examples, visit the\n   * [auth section](/docs/recipes/auth.md)\n   * @param {Object} authData - Auth data from Firebase's getRedirectResult\n   * @return {Promise} Containing user's profile\n   */\n  const handleRedirectResult = authData =>\n    authActions.handleRedirectResult(dispatch, firebase, authData)\n\n  /**\n   * Logs user out of Firebase and empties firebase state from\n   * redux store\n   * @return {Promise}\n   */\n  const logout = () => authActions.logout(dispatch, firebase)\n\n  /**\n   * Creates a new user in Firebase authentication. If\n   * `userProfile` config option is set, user profiles will be set to this\n   * location.\n   * @param {Object} credentials - Credentials for authenticating\n   * @param {String} credentials.email - Credentials for authenticating\n   * @param {String} credentials.password - Credentials for authenticating (only used with email)\n   * @param {Object} profile - Data to include within new user profile\n   * @return {Promise} Containing user's auth data\n   */\n  const createUser = (credentials, profile) =>\n    authActions.createUser(dispatch, firebase, credentials, profile)\n\n  /**\n   * Sends password reset email\n   * @param {Object} credentials - Credentials for authenticating\n   * @param {String} credentials.email - Credentials for authenticating\n   * @return {Promise}\n   */\n  const resetPassword = credentials =>\n    authActions.resetPassword(dispatch, firebase, credentials)\n\n  /**\n   * Confirm that a user's password has been reset\n   * @param {String} code - Password reset code to verify\n   * @param {String} password - New Password to confirm reset to\n   * @return {Promise}\n   */\n  const confirmPasswordReset = (code, password) =>\n    authActions.confirmPasswordReset(dispatch, firebase, code, password)\n\n  /**\n   * Verify that a password reset code from a password reset\n   * email is valid\n   * @param {String} code - Password reset code to verify\n   * @return {Promise} Containing user auth info\n   */\n  const verifyPasswordResetCode = code =>\n    authActions.verifyPasswordResetCode(dispatch, firebase, code)\n\n  /**\n   * Update user profile on Firebase Real Time Database or\n   * Firestore (if `useFirestoreForProfile: true` config passed to\n   * reactReduxFirebase). Real Time Database update uses `update` method\n   * internally while updating profile on Firestore uses `set` with\n   * @param {Object} profileUpdate - Profile data to place in new profile\n   * @param {Object} options - Options object (used to change how profile\n   * update occurs)\n   * @param  {Boolean} [options.useSet=true] - Use set with merge instead of\n   * update. Setting to `false` uses update (can cause issue of profile document\n   * does not exist). Note: Only used when updating profile on Firestore\n   * @param  {Boolean} [options.merge=true] - Whether or not to use merge when\n   * setting profile. Note: Only used when updating profile on Firestore\n   * @return {Promise}\n   */\n  const updateProfile = (profileUpdate, options) =>\n    authActions.updateProfile(dispatch, firebase, profileUpdate, options)\n\n  /**\n   * Update Auth Object\n   * @param {Object} authUpdate - Update to be auth object\n   * @param {Boolean} updateInProfile - Update in profile\n   * @return {Promise}\n   */\n  const updateAuth = (authUpdate, updateInProfile) =>\n    authActions.updateAuth(dispatch, firebase, authUpdate, updateInProfile)\n\n  /**\n   * Update user's email\n   * @param {String} newEmail - Update to be auth object\n   * @param {Boolean} updateInProfile - Update in profile\n   * @return {Promise}\n   */\n  const updateEmail = (newEmail, updateInProfile) =>\n    authActions.updateEmail(dispatch, firebase, newEmail, updateInProfile)\n\n  /**\n   * Reload user's auth object. Must be authenticated.\n   * @return {Promise}\n   */\n  const reloadAuth = () => authActions.reloadAuth(dispatch, firebase)\n\n  /**\n   * Links the user account with the given credentials.\n   * @param {firebase.auth.AuthCredential} credential - The auth credential\n   * @return {Promise}\n   */\n  const linkWithCredential = credential =>\n    authActions.linkWithCredential(dispatch, firebase, credential)\n\n  /**\n   * @name signInWithPhoneNumber\n   * @description Asynchronously signs in using a phone number. This method\n   * sends a code via SMS to the given phone number, and returns a modified\n   * firebase.auth.ConfirmationResult. The `confirm` method\n   * authenticates and does profile handling.\n   * @param {firebase.auth.ConfirmationResult} credential - The auth credential\n   * @return {Promise}\n   */\n  /**\n   * @name initializeAuth\n   * @description Initialize auth to work with build in profile support\n   */\n  const actionCreators = mapWithFirebaseAndDispatch(\n    firebase,\n    dispatch,\n    // Actions with arg order (firebase, dispatch)\n    {\n      signInWithPhoneNumber: authActions.signInWithPhoneNumber\n    },\n    // Actions with arg order (dispatch, firebase)\n    {\n      initializeAuth: authActions.init\n    }\n  )\n\n  /**\n   * @name ref\n   * @description Firebase ref function\n   * @return {firebase.database.Reference}\n   */\n  /**\n   * @name database\n   * @description Firebase database service instance including all Firebase storage methods\n   * @return {firebase.database.Database} Firebase database service\n   */\n  /**\n   * @name storage\n   * @description Firebase storage service instance including all Firebase storage methods\n   * @return {firebase.database.Storage} Firebase storage service\n   */\n  /**\n   * @name auth\n   * @description Firebase auth service instance including all Firebase auth methods\n   * @return {firebase.database.Auth}\n   */\n  firebaseInstance = Object.assign(firebase, {\n    _reactReduxFirebaseExtended: true,\n    ref: path => firebase.database().ref(path),\n    set,\n    setWithMeta,\n    uniqueSet,\n    push,\n    pushWithMeta,\n    remove,\n    update,\n    updateWithMeta,\n    login,\n    handleRedirectResult,\n    logout,\n    updateAuth,\n    updateEmail,\n    updateProfile,\n    uploadFile,\n    uploadFiles,\n    deleteFile,\n    createUser,\n    resetPassword,\n    confirmPasswordReset,\n    verifyPasswordResetCode,\n    watchEvent,\n    unWatchEvent,\n    reloadAuth,\n    linkWithCredential,\n    promiseEvents,\n    dispatch,\n    ...actionCreators\n  })\n  return firebaseInstance\n}\n\n/**\n * Expose Firebase instance created internally. Useful for\n * integrations into external libraries such as redux-thunk and redux-observable.\n * @example <caption>redux-thunk integration</caption>\n * import { applyMiddleware, compose, createStore } from 'redux';\n * import thunk from 'redux-thunk';\n * import { getFirebase } from 'react-redux-firebase';\n * import makeRootReducer from './reducers';\n *\n * const fbConfig = {} // your firebase config\n *\n * const store = createStore(\n *   makeRootReducer(),\n *   initialState,\n *   compose(\n *     applyMiddleware([\n *       // Pass getFirebase function as extra argument\n *       thunk.withExtraArgument(getFirebase)\n *     ])\n *   )\n * );\n * // then later\n * export function addTodo(newTodo) {\n *   return (dispatch, getState, getFirebase) => {\n *     const firebase = getFirebase()\n *     firebase\n *       .push('todos', newTodo)\n *       .then(() => {\n *         dispatch({ type: 'SOME_ACTION' })\n *       })\n *   }\n * }\n *\n */\nexport function getFirebase() {\n  /* istanbul ignore next: Firebase instance always exists during tests */\n  if (!firebaseInstance) {\n    throw new Error(\n      'Firebase instance does not yet exist. Check your compose function.'\n    ) // eslint-disable-line no-console\n  }\n  return firebaseInstance\n}\n"],"file":"createFirebaseInstance.js"}